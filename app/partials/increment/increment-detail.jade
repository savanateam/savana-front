doctype html

div.wrapper(
    ng-controller="IncrementDetailController as ctrl",
    ng-init="section='increments'"
)
    tg-project-menu

    div.main.us-detail
        div.us-detail-header.header-with-actions
            include ../includes/components/mainTitle

        section.us-story-main-data
            header
                tg-vote-button.upvote-btn(
                    item="increment"
                    on-upvote="ctrl.onUpvote"
                    on-downvote="ctrl.onDownvote"
                )
                .us-title(ng-class="{blocked: increment.is_blocked}")
                    h2.us-title-text
                        span.us-number(tg-bo-ref="increment.ref")
                        span.us-name(tg-editable-subject, ng-model="increment", required-perm="modify_increment")

                    p.us-related-task(ng-if="increment.generated_user_stories.length")
                        | {{ 'INCREMENTS.PROMOTED'|translate }}
                        a(
                            href=""
                            ng-repeat="us in increment.generated_user_stories"
                            tg-check-permission="view_us"
                            tg-bo-title="'#' + us.ref + ' ' + us.subject"
                            tg-nav="project-userstories-detail:project=project.slug,ref=us.ref"
                        )
                              span(tg-bo-ref="us.ref")

                    p.external-reference(ng-if="increment.external_reference")
                        | {{ 'INCREMENTS.EXTERNAL_REFERENCE'|translate }}
                        a(
                            target="_blank"
                            tg-bo-href="increment.external_reference[1]"
                            title="{{'INCREMENTS.GO_TO_EXTERNAL_REFERENCE' | translate}}"
                        )
                            span {{ increment.external_reference[1] }}

                    p.block-desc-container(ng-show="increment.is_blocked")
                        span.block-description-title(translate="COMMON.BLOCKED")
                        span.block-description(ng-bind="increment.blocked_note || ('INCREMENTS.BLOCKED' | translate)")

                    div.increment-nav
                        a.icon.icon-arrow-left(
                            ng-show="previousUrl"
                            tg-bo-href="previousUrl"
                            title="{{'INCREMENTS.TITLE_PREVIOUS_ISSUE' | translate}}"
                        )
                        a.icon.icon-arrow-right(
                            ng-show="nextUrl"
                            tg-bo-href="nextUrl"
                            title="{{'INCREMENTS.TITLE_NEXT_ISSUE' | translate}}"
                        )
            .subheader
                div.tags-block(tg-tag-line, ng-model="increment", required-perm="modify_increment")
                tg-created-by-display.ticket-created-by(ng-model="increment")

        // section.duty-content(tg-editable-description, tg-editable-wysiwyg, ng-model="increment", required-perm="modify_increment")

        // Custom Fields

        //tg-custom-attributes-values(
        //    ng-model="increment"
        //    type="increment"
        //    project="project"
        //    required-edition-perm="modify_increment"
        //)

        tg-attachments-full(
            obj-id="increment.id"
            type="productincrement",
            project-id="projectId"
        )

        // tg-history(ng-model="increment", type="increment")

    sidebar.menu-secondary.sidebar.ticket-data
        
        .ticket-header
            span.ticket-title(
                tg-increment-status-display
                ng-model="increment"
            )
            span.detail-status(
                tg-increment-status-button
                ng-model="increment"
            )
        
        //tg-created-by-display.ticket-created-by(ng-model="increment")



    div.lightbox.lightbox-block(tg-lb-block, ng-model="increment", title="INCREMENTS.LIGHTBOX_TITLE_BLOKING_ISSUE")
    div.lightbox.lightbox-select-user(tg-lb-assignedto)
    div.lightbox.lightbox-select-user(tg-lb-watchers)
